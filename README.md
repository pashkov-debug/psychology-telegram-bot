# psychology-telegram-bot

Telegram-бот «Психология: витрина + заявка на консультацию» (:contentReference[oaicite:0]{index=0} + long polling)

Бот показывает кнопки-ссылки на ваш сайт (витрина) и принимает заявку на консультацию: пользователь оставляет телефон + короткий текст запроса, после подтверждения бот пересылает заявку администратору в :contentReference[oaicite:1]{index=1}.

> Раньше проект был настроен под **Webhook + Web Service**. Сейчас по итогам деплоя переведено на **Long polling + Background Worker** (воркер) на Render — это стабильнее для бота 24/7 и убирает зависимость от HTTP/портов. :contentReference[oaicite:2]{index=2}

---

## Возможности (MVP)

- Меню-витрина: «Бесплатное», «Обо мне», «Контакты», «Записаться», «Приватность»
- Сценарий записи (FSM):
  - запрос телефона (контакт или вручную)
  - запрос текста (1–3 предложения)
  - предпросмотр
  - подтверждение / редактирование / отмена
- Отправка заявки админу (`ADMIN_CHAT_ID`)

---

## Важно (ограничения MVP)

- **База данных не используется**: данные заявки живут в памяти до отправки. Если сервис перезапустится — незавершённый сценарий может сброситься.
- Админ **получит сообщения** от бота только если **хотя бы один раз нажал `/start`** у бота (ограничение Telegram).
- **Нельзя запускать несколько копий polling одновременно** с одним токеном: Telegram вернёт `Conflict: terminated by other getUpdates request`.

---

## Структура проекта

### `app.py`
Точка входа **Background Worker**.

- Загружает переменные окружения (`.env` локально / Env Vars на Render)
- Инициализирует бота и диспетчер
- **Отключает webhook** на старте (на случай, если он был установлен раньше)
- Запускает **long polling**

> Воркер на Render не принимает HTTP-трафик и не должен слушать порт. Для этого и выбирается service type **Background Worker**. :contentReference[oaicite:3]{index=3}

### `requirements.txt`
Зависимости Python (минимум):

- `aiogram`
- `python-dotenv`

> `aiohttp` больше не требуется для деплоя воркера (webhook мы не используем). Если у вас он остался в `requirements.txt` — не критично, но можно удалить для ускорения сборки.

### `.env.example`
Шаблон переменных окружения (секреты и ссылки). Заполняется вами и **НЕ коммитится** как `.env` в публичный репозиторий.

### `bot/`
Логика бота.

- `bot/content.py` — тексты и ссылки витрины (читаются из env)
- `bot/keyboards.py` — клавиатуры/кнопки
- `bot/states.py` — FSM состояния
- `bot/handlers.py` (или `bot/handlers/*`) — обработчики команд/кнопок + сценарий записи

---

## Переменные окружения

### Минимально необходимые
- `BOT_TOKEN` — токен Telegram-бота
- `ADMIN_CHAT_ID` — куда отправлять заявки

### Ссылки витрины (примерный набор)
- `SITE_HOME_URL`
- `SITE_ABOUT_URL`
- `SITE_FREE_URL`
- `SITE_CONTACT_URL`
- `SITE_BOOK_URL` (опционально)

### Исторические переменные (для старого webhook-режима)
- `PUBLIC_BASE_URL`
- `WEBHOOK_SECRET`

> В текущем режиме **polling** эти переменные **не используются**, но можно оставить в env без вреда (если они нужны где-то ещё в коде/контенте).

---

## Запуск локально

1) Создайте `.env` рядом с `app.py` по образцу `.env.example`
2) Установите зависимости:
```bash
pip install -r requirements.txt
