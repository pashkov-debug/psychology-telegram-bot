# psychology-telegram-bot

# Telegram-бот «Психология: витрина + заявка на консультацию» (Render + Webhook)

Бот показывает кнопки-ссылки на ваш сайт (витрина) и принимает заявку на консультацию:
пользователь оставляет телефон + короткий текст запроса, после подтверждения бот пересылает заявку администратору в Telegram.

## Возможности (MVP)
- Меню-витрина: «Бесплатное», «Обо мне», «Контакты», «Записаться», «Приватность»
- Сценарий записи (FSM):
  1) запрос телефона (контакт или вручную)
  2) запрос текста (1–3 предложения)
  3) предпросмотр
  4) подтверждение/редактирование/отмена
- Отправка заявки админу (ADMIN_CHAT_ID)

## Важно (ограничения MVP)
- База данных не используется: данные заявки живут в памяти до отправки.
  Если сервис перезапустится — незавершённый сценарий может сброситься.
- Render Free может “усыплять” сервис после простоя → возможна задержка при первом обращении.
- Бот может написать админу только если админ хотя бы раз нажал `/start` у бота.

---

## Структура проекта и аннотация файлов

### `app.py`
Точка входа приложения.
- Поднимает `aiohttp` веб-сервер (эндпоинты: `/webhook/<secret>`, `/health`)
- Инициализирует `aiogram` (`Bot`, `Dispatcher`, `MemoryStorage`)
- Регистрирует webhook у Telegram (если задан `PUBLIC_BASE_URL`)
- Подключает роутеры из `bot/handlers.py`

### `requirements.txt`
Список зависимостей Python:
- `aiogram` — логика Telegram-бота (handlers, FSM)
- `aiohttp` — сервер под webhook
- `python-dotenv` — чтение `.env` локально

### `.env.example`
Шаблон переменных окружения (секреты и ссылки).
Заполняется вами и НЕ коммитится как `.env` в публичный репозиторий.
- `BOT_TOKEN` — токен Telegram-бота
- `WEBHOOK_SECRET` — секрет в URL и проверка `secret_token`
- `PUBLIC_BASE_URL` — публичный адрес Render-сервиса
- `ADMIN_CHAT_ID` — куда отправлять заявки
- `SITE_*` — ссылки на страницы сайта

---

## Папка `bot/` — логика бота

### `bot/content.py`
Контент и настройки “витрины”.
- Ссылки на сайт (`SITE_*`) читаются из env
- Тексты приветствия, дисклеймера и приватности

### `bot/keyboards.py`
Кнопки/клавиатуры:
- Inline-меню (витрина)
- Кнопка “Открыть” (URL) + “Меню”
- Reply-клавиатура для запроса контакта (request_contact)
- Inline-кнопки подтверждения заявки: отправить/редактировать/отмена

### `bot/states.py`
Состояния FSM (Finite State Machine) для сценария записи:
- `phone` — сбор телефона
- `request_text` — сбор текста запроса
- `confirm` — предпросмотр и подтверждение

### `bot/handlers.py`
Главные обработчики:
- `/start`, `/menu`, `/whoami`
- Обработчики кнопок меню
- FSM-сценарий “Запрос на консультацию”
- Валидация телефона и длины текста
- Сбор финального сообщения и отправка админу (`ADMIN_CHAT_ID`)

---

## Переменные окружения

Минимально необходимые:
- `BOT_TOKEN`
- `WEBHOOK_SECRET`
- `PUBLIC_BASE_URL` (для Render/webhook)
- `ADMIN_CHAT_ID`

Ссылки витрины:
- `SITE_HOME_URL`
- `SITE_ABOUT_URL`
- `SITE_FREE_URL`
- `SITE_BOOK_URL` (опционально; в нашем сценарии запись идёт через сбор заявки)
- `SITE_CONTACT_URL`

---

## Локальный запуск (для проверки)
> Внимание: webhook локально не зарегистрируется без публичного URL.
> Для простой проверки достаточно, чтобы проект стартовал без ошибок.

1) Скопируйте пример env:
```bash
cp .env.example .env
